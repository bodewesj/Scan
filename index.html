<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barcode Inventarisatie</title>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
body{font-family:sans-serif;background:#f0f4f8;padding:16px;}
#reader{width:100%;max-width:500px;margin:0 auto;}
.input-row{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
input,button{padding:6px; border-radius:4px; border:1px solid #ccc;}
table{margin-top:12px;width:100%;border-collapse:collapse;}
th,td{border:1px solid #ccc;padding:6px;text-align:left;}
</style>
</head>
<body>

<h1>Barcode Inventarisatie (Android-ready)</h1>

<div id="reader"></div>

<div class="input-row">
<input id="barcode" placeholder="Barcode" readonly>
<input id="articleId" placeholder="Artikel ID">
<input id="quantity" type="number" value="1" min="1">
<button id="confirmBtn">Bevestig item</button>
<button id="downloadBtn">Download CSV</button>
</div>

<table id="itemsTable">
<thead>
<tr><th>Tijd</th><th>Barcode</th><th>Artikel ID</th><th>Aantal</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const items=[];

function updateTable(){
  const tbody=document.querySelector("#itemsTable tbody");
  tbody.innerHTML="";
  items.forEach(i=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${new Date(i.time).toLocaleString()}</td><td>${i.barcode}</td><td>${i.articleId}</td><td>${i.quantity}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById("confirmBtn").addEventListener("click",()=>{
  const bc=document.getElementById("barcode").value;
  const aid=document.getElementById("articleId").value;
  const q=document.getElementById("quantity").value||1;
  if(!bc){alert("Geen barcode");return;}
  items.push({time:new Date().toISOString(),barcode:bc,articleId:aid,quantity:q});
  updateTable();
  document.getElementById("barcode").value="";
  document.getElementById("articleId").value="";
  document.getElementById("quantity").value=1;
});

document.getElementById("downloadBtn").addEventListener("click",()=>{
  if(items.length===0){alert("Geen items");return;}
  let filename=prompt("Bestandsnaam","inventaris");
  if(!filename) filename="inventaris";
  if(!filename.endsWith(".csv")) filename+=".csv";
  const header="time,barcode,articleId,quantity\n";
  const rows=items.map(i=>`${i.time},${i.barcode},${i.articleId},${i.quantity}`).join("\n");
  const blob=new Blob([header+rows],{type:"text/csv;charset=utf-8"});
  const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href);
});

// html5-qrcode setup
const html5QrcodeScanner=new Html5Qrcode("reader");
const config={fps:10,qrbox:250};

html5QrcodeScanner.start(
  { facingMode:"environment" },
  config,
  decodedText=>{
    document.getElementById("barcode").value=decodedText;
  },
  errorMessage=>{
    //console.log("scan error:", errorMessage);
  }
).catch(err=>console.error(err));
</script>

</body>
</html>
